<div class="home-container">

  <div class="search-box">
    <h2>Find the right care, faster.</h2>
    <p>Describe your symptoms in plain language and let our AI guide you.</p>

    <div class="input-group">

      <div class="textarea-container">
        <textarea rows="3"
                  [placeholder]="isListening() ? 'Listening... speak now' : placeholderText"
                  [value]="symptomInput()"
                  (input)="symptomInput.set($any($event.target).value)"
                  [class.listening]="isListening()"></textarea>

        @if (isSpeechSupported) {
        <button class="voice-btn-inside"
                (click)="startSpeechRecognition()"
                [disabled]="isListening()"
                [class.listening]="isListening()"
                title="Search with voice">
          <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor">
            <path d="M0 0h24v24H0V0z" fill="none" />
            <path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1.2-9.1c0-.66.54-1.2 1.2-1.2s1.2.54 1.2 1.2l-.01 6.2c0 .66-.53 1.2-1.19 1.2s-1.2-.54-1.2-1.2V4.9zM17 11c0 2.76-2.09 5-4.72 5C9.62 16 7.4 13.9 7 11.23H5c.41 3.38 3.1 6.02 6.5 6.25V21h1v-3.72c3.4-.23 6.09-2.87 6.5-6.25h-2z" />
          </svg>
        </button>
        }
      </div> <div class="button-group">
        <button class="primary" (click)="onSearch()" [disabled]="healthService.isLoading()">
          @if (healthService.isLoading() && !isListening()) {
          <span class="loader"></span>
          } @else {
          Find Care
          }
        </button>
        <button class="secondary" (click)="onClear()" [disabled]="healthService.isLoading()">Clear</button>
      </div>

    </div>
  </div> @if (healthService.error(); as error) {
  <div class="error-box">
    <strong>Error:</strong> {{ error }}
  </div>
  }

  <div class="results-container">

    @if (healthService.recommendation(); as rec) {
    <div class="recommendation-section">
      <h3>AI Recommended Specialties</h3>
      <p class="reasoning">"{{ rec.reasoning }}"</p>
      <div class="specialty-tags">
        @for (spec of rec.specialties; track spec) {
        <button class="specialty-tag"
                (click)="onSelectSpecialty(spec)"
                [class.selected]="healthService.selectedSpecialty() === spec"
                [disabled]="healthService.isLoading()">
          {{ spec }}
        </button>
        }
      </div>
    </div>
    }

    @if (healthService.providers(); as providerList) {
    <div class="provider-section">
      <h3>Available Providers for "{{ healthService.selectedSpecialty() }}"</h3>
      @if (providerList.length === 0) {
      <p>No providers found in our mock database for this specialty.</p>
      } @else {
      <div class="provider-list">
        @for (provider of providerList; track provider.id) {
        <app-provider-card [provider]="provider" />
        }
      </div>
      }
    </div>
    }

  </div>
</div>
