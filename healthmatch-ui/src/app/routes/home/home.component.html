<div class="home-container">
  
  <div class="search-box">
    <h2>Find the right care, faster.</h2>
    <p>Not sure which specialist to see? Describe your symptoms, and our AI will instantly recommend the right provider for your needs.</p>
    
    <div class="input-group">
      <div class="textarea-container">
        <textarea
          rows="3"
          [placeholder]="isListening() ? 'Listening... speak now' : placeholderText"
          [value]="symptomInput()"
          (input)="symptomInput.set($any($event.target).value)"
          [class.listening]="isListening()"
        ></textarea>
        
        @if (isSpeechSupported) {
          <button
            class="voice-btn-inside"
            (click)="startSpeechRecognition()"
            [disabled]="isListening()"
            [class.listening]="isListening()"
            title="Search with voice"
          >
            <svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1.2-9.1c0-.66.54-1.2 1.2-1.2s1.2.54 1.2 1.2l-.01 6.2c0 .66-.53 1.2-1.19 1.2s-1.2-.54-1.2-1.2V4.9zM17 11c0 2.76-2.09 5-4.72 5C9.62 16 7.4 13.9 7 11.23H5c.41 3.38 3.1 6.02 6.5 6.25V21h1v-3.72c3.4-.23 6.09-2.87 6.5-6.25h-2z"/></svg>
          </button>
        }
      </div>

      <div class="button-group">
        <button class="primary" (click)="onSearch()" [disabled]="healthService.isLoading()">
          @if (healthService.isLoading() && !isListening()) {
            <span class="loader"></span>
          } @else {
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>
            Find Care
          }
        </button>
        <button class="secondary" (click)="onClear()" [disabled]="healthService.isLoading()">Clear</button>
      </div>
    </div>
  </div>


  @if (healthService.error(); as error) {
    <div class="error-box">
      <strong>Error:</strong> {{ error }}
    </div>
  }

  <div class="results-container">
    
    @if (healthService.recommendation(); as rec) {
      <div class="recommendation-section">
        <h3>AI Recommended Specialties</h3>
        <blockquote class="reasoning">{{ rec.reasoning }}</blockquote>
        <div class="specialty-tags">
          @for (spec of rec.specialties; track spec) {
            <button
              class="specialty-tag"
              (click)="onSelectSpecialty(spec)"
              [class.selected]="healthService.selectedSpecialty() === spec"
              [disabled]="healthService.isLoading()"
            >
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58s1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41s-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"/></svg>
              {{ spec }}
            </button>
          }
        </div>
      </div>
    }

    @if (healthService.providers(); as providerList) {
      <div class="provider-section">
        
        <div class="provider-header">
          <h3>Available Providers for "{{ healthService.selectedSpecialty() }}"</h3>
          <app-filters 
            [locations]="availableLocations()" 
            (filtersChanged)="onFiltersChanged($event)"
          />
        </div>
        
        @if (filteredProviders().length === 0) {
          <p class_="no-results-text">No providers match your filter criteria.</p>
        } @else {
          <div class="provider-stub-list">
            @for (provider of filteredProviders(); track provider.id) {
              <app-provider-stub 
                [provider]="provider"
                (scheduleClicked)="openProviderModal(provider)" 
              />
            }
          </div>
        }
      </div>
    }
  </div>

  @if (isProviderModalOpen()) {
    <app-provider-detail-modal 
      [provider]="selectedProvider()" 
      (closeModal)="closeProviderModal()" 
    />
  }
</div>